(()=>{"use strict";var e,t,n,r,a,o,i,c,l=Object.freeze({gain:.5,numSamples:256}),s=function(e){return n.src=e},u=function(t){t?o.gain.setValueAtTime(25,e.currentTime):o.gain.setValueAtTime(0,e.currentTime)},h=function(t){t?i.gain.setValueAtTime(25,e.currentTime):i.gain.setValueAtTime(0,e.currentTime)},d=function(e,t){c.curve=e?f(t):null},f=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=new Float32Array(256),n=0;n<256;++n){var r=2*n/256-1;t[n]=(Math.PI+e)*r/(Math.PI+e*Math.abs(r))}return t};function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==v(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===v(a)?a:String(a)),r)}var a}var m,g,p,b,w=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,{x:t,y:n,radius:r}),this.dx=1,this.dy=1,this.color="white"}var t,n;return t=e,n=[{key:"update",value:function(e,t){t&&(this.x+=Math.pow(t/100,2),this.y+=Math.pow(t/100,2)),this.wrapAround(e),this.draw(e)}},{key:"draw",value:function(e){e.save(),e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.radius,0,2*Math.PI),e.fill(),e.restore()}},{key:"wrapAround",value:function(e){this.x-this.radius>e.canvas.width&&(this.x=-1*this.radius),this.y-this.radius>e.canvas.height&&(this.y=-1*this.radius),this.x+this.radius<0&&(this.x=e.canvas.width-this.radius),this.y+this.radius<0&&(this.y=e.canvas.height-this.radius)}},{key:"distance",value:function(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}},{key:"setRadius",value:function(e){this.radius=e}},{key:"setColor",value:function(e){this.color=e}}],n&&y(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var M,k=100,T=[],P=function(e,t,n,r,a,o){var i,c=e.createLinearGradient(t,n,r,a),l=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw o}}}}(o);try{for(l.s();!(i=l.n()).done;){var s=i.value;c.addColorStop(s.percent,s.color)}}catch(e){l.e(e)}finally{l.f()}return c},q={bars:!0,circles:!0,distortion:!1,distortionAmount:20,emboss:!1,gradient:!0,highshelf:!1,invert:!1,lowshelf:!1,noise:!1,visualize:!0,volume:50},A=function(t){document.querySelector("#btn-fs").onclick=function(e){console.log("goFullscreen() called"),I(t)};var r=document.querySelector("#btn-play");r.onclick=function(t){"suspended"==e.state&&e.resume(),"no"==t.target.dataset.playing?(n.play(),t.target.dataset.playing="yes"):(n.pause(),t.target.dataset.playing="no")};var o=document.querySelector("#slider-volume"),i=document.querySelector("#label-volume");o.oninput=function(e){var t;t=e.target.value,a.gain.value=Number(t),q.volume=e.target.value/2*100,i.innerHTML="".concat(Math.round(e.target.value/2*100),"%")},o.dispatchEvent(new Event("input")),document.querySelector("#select-track").onchange=function(e){s(e.target.value),(r.dataset.playing="yes")&&r.dispatchEvent(new MouseEvent("click"))},Object.getOwnPropertyNames(q).forEach((function(e){var t=document.querySelector("#cb-".concat(e));t&&(t.checked=q[e],t.onchange=function(t){q[e]=t.target.checked,"highshelf"==e?u(t.target.checked):"lowshelf"==e?h(t.target.checked):"distortion"==e&&d(t.target.checked,q.distortionAmount)})})),u(q.highshelf),h(q.lowshelf),d(q.distortion,q.distortionAmount)},E=function e(t){setTimeout(e,1e3/60),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(g.getByteFrequencyData(p),p=p.slice(0,k),e.visualize){b.style.display="none",M.style.display="block",m.rect(0,0,m.canvas.width,m.canvas.height),e.gradient&&(m.save(),m.fillStyle=P(m,0,0,0,m.canvas.height,[{percent:0,color:"purple"},{percent:.5,color:"indigo"}]),m.fillRect(0,0,m.canvas.width,m.canvas.height),m.restore()),e.circles&&function(e){var t=m.canvas.height/4;m.save(),m.globalAlpha=.5;for(var n=0;n<p.length;n++){var r=p[n]/255,a=r*t,o=m.canvas.width/2,i=m.canvas.height/2,c="rgba(255, 111, 111, ".concat(.34-r/3,")"),l="rgba(111, 111, 255, ".concat(.1-r/10,")"),s="rgba(255, 255, 111, ".concat(.25-r/4,")"),u=a,h=1.5*a,d=.5*a;m.fillStyle=c,m.beginPath(),m.arc(o,i,u,0,2*Math.PI,!1),m.fill(),m.closePath(),m.fillStyle=l,m.beginPath(),m.arc(o,i,h,0,2*Math.PI,!1),m.fill(),m.closePath(),m.fillStyle=s,m.beginPath(),m.arc(o,i,d,0,2*Math.PI,!1),m.fill(),m.closePath(),m.restore()}m.restore()}(),e.bars&&function(e){for(var t=100,n=0;n<p.length;n++){var r=2*n*Math.PI/p.length,a=m.canvas.width/2+Math.cos(r-Math.PI/2)*t,o=m.canvas.height/2+Math.sin(r-Math.PI/2)*t,i=m.canvas.width/2+Math.cos(r-Math.PI/2)*(t+p[n]),c=m.canvas.height/2+Math.sin(r-Math.PI/2)*(t+p[n]),l="hsl(".concat(n/p.length*255,", 100%, ").concat(e.volume/2+25,"%)");m.save(),m.beginPath(),m.moveTo(a,o),m.lineTo(i,c),m.closePath(),m.lineWidth=3,m.strokeStyle=l,m.stroke(),m.closePath(),m.restore()}}(e);var t=m.getImageData(0,0,m.canvas.width,m.canvas.height),n=t.data,r=n.length,a=t.width;e.noise&&function(e,t){for(var n=0;n<t;n+=4)Math.random()<.05&&(e[n]=e[n+1]=e[n+2]=0,e[n+2]=255)}(n,r),e.invert&&function(e,t){for(var n=0;n<t;n+=4){var r=e[n],a=e[n+1],o=e[n+2];e[n]=255-r,e[n+1]=255-a,e[n+2]=255-o}}(n,r),e.emboss&&function(e,t,n){for(var r=0;r<t;r++)r%4!=3&&(e[r]=127+2*e[r]-e[r+4]-e[r+4*n])}(n,r,a),m.putImageData(t,0,0);for(var o=0;o<T.length;o++)T[o].setRadius(Math.pow(p[o]/50,2)),T[o].setColor("hsl(".concat(o/p.length*255,", 100%, ").concat(e.volume/2+25,"%)")),T[o].update(m,p[o])}else{b.style.display="block",M.style.display="none";var i=new Uint8Array(g.fftSize);i=i.slice(0,k),g.getByteTimeDomainData(i),function(e){b.innerHTML="";for(var t=[document.createElement("tr")],n=0;n<k;n++){n%10==0&&(t.push(document.createElement("tr")),t[t.length-1].innerHTML="<td><b>".concat(n," - ").concat(n+9,"</b></td>"));var r=document.createElement("td");r.innerHTML=128-e[n],r.style.color="hsl(".concat(Math.pow(e[n],2),", 100%, 50%)"),r.style.border="1px solid black",t[t.length-1].appendChild(r)}t.forEach((function(e){return b.appendChild(e)}))}(i)}}(q)},I=function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullscreen?e.mozRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()};window.onload=function(){return(u=new XMLHttpRequest).onload=function(u){return function(u){document.querySelector("title").innerHTML=u.title,document.querySelector("#header").innerHTML=u.title,document.querySelector("#description").innerHTML=u.description;for(var h,d,f=document.querySelector("#select-track"),v=0;v<u.tracks.length;v++){var y=document.createElement("option");y.value="media/".concat(u.tracks[v],".mp3"),y.innerHTML=u.tracks[v],f.appendChild(y)}h="media/".concat(u.tracks[0],".mp3"),d=window.AudioContext||window.webkitAudioContext,e=new d,n=new Audio,s(h),r=e.createMediaElementSource(n),(o=e.createBiquadFilter()).type="highshelf",o.frequency.setValueAtTime(1e3,e.currentTime),(i=e.createBiquadFilter()).type="lowshelf",i.frequency.setValueAtTime(1e3,e.currentTime),c=e.createWaveShaper(),(t=e.createAnalyser()).fftSize=l.numSamples,(a=e.createGain()).gain.value=l.gain,r.connect(o),o.connect(i),i.connect(c),c.connect(t),t.connect(a),a.connect(e.destination);var S=document.querySelector("canvas");A(S),function(e,t){m=(M=e).getContext("2d"),g=t,p=new Uint8Array(g.fftSize/2),b=document.createElement("table"),document.querySelector("#data").appendChild(b);for(var n=0;n<k;n++)T.push(new w(m.canvas.width/k*n,0,0))}(S,t),E()}(JSON.parse(u.target.response))},u.onerror=function(e){return console.log(e.target.status)},u.open("GET","./data/av-data.json"),void u.send();var u}})();